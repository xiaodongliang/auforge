define("mediaServices",["lodash","constants","util","stateManagement","media-manager-api","image-client-api","MediaImageStudio","videoMakerOpener","UserFeedbackOpener","coreBi"],function(C,e,A,F,a,p,t,i,n,o){"use strict";var I=o.events.singleVideoPlayer,r=A.backgroundUtils,P=r.getMediaPlayerVideoObject,w=r.getChangeVideoBiEventFields,L=r.getStoryboardDisplayValue,R=F.editorPlugins.userPreferences.actions.setSessionUserPreferences,s=F.editorPlugins.userPreferences.selectors.getSessionUserPreferences,m=F.editorPlugins.userPreferences.selectors.getMediaPath,d=e.CLIPART_DATA_KEYS,c=e.VECTOR_IMAGE_DEFAULTS,u=c.VECTOR_IMAGE_CATEGORY,g=c.VECTOR_SHAPE_DEFAULT_PATH,h=c.VECTOR_ART_DEFAULT_PATH,f="change_basic_shape";function l(e){var a=e.split("/");return 2===a.length?parseFloat(a[0])/parseFloat(a[1]):parseFloat(a[0])}function _(e){return 50<l(e)}function v(e){return e&&_(e)?30/l(e):1}return{create:function(E){function k(){var e=window.document.querySelector("#editor");if(e){var a=window.document,t=a.documentElement.scrollTop||a.body.scrollTop;e.focus(),a.documentElement.scrollTop=a.body.scrollTop=t}}return{initMediaManager:function(e){E.mediaServices.mediaManager=a.create(C.assign(e,{origin:a.origins.EDITOR}))},mediaManager:null,initMediaStudio:function(e){var a=t.default;E.mediaServices.mediaStudio=new a(e)},mediaStudio:null,initVideoMaker:function(){E.mediaServices.videoMaker=new i.VideoMakerOpener},videoMaker:null,initUserFeedback:function(e){var a=n.default;E.mediaServices.userFeedback=new a(e)},userFeedback:null,hasSlowMo:_,getPlaybackSpeedByFPS:v,setFocusToEditor:k,changeWPhoto:function(c){var l=A.imageTransform.fittingTypes,u=E.components.data.get(c),e=E.store,g=e.dispatch,a=(0,e.getState)(),t=m(u.uri)(a);E.mediaServices.mediaManager.open(E.mediaServices.mediaManager.categories.IMAGE,"change_image",{translation:{title:A.translate("Image_Media_Choose_Image"),submitButton:A.translate("MMGR_submitbutton_onstage_image_uploads_choose")},path:t,multiSelect:!1,callback:function(e,a){if(e){var t=C.head(e),i=E.components.layout.get(c),n=E.components.properties.get(c).displayMode,o=t.width,r=t.height,s={width:o,height:r,uri:t.fileName,name:t.title,alt:t.title,crop:null,focalPoint:null,originalImageDataRef:null};if(u.crop&&E.imageCrop.isCropAllowed(s.uri)&&!A.url.isExternalUrl(s.uri)){var d=function(e,a,t,i,n){if(n!==p.fittingTypes.SCALE_TO_FILL&&n!==p.fittingTypes.LEGACY_FULL)return null;var o=Math.min(t/e,i/a),r=e*o,s=a*o;return{width:Math.round(r),height:Math.round(s),x:Math.round((t-r)/2),y:Math.round((i-s)/2)}}(i.width,i.height,o,r,n);s.crop=C.assign({},u.crop,d)}g(R("last_media_path_"+s.uri,a.path)),E.components.data.update(c,s,!0),n===A.imageTransform.fittingTypes.LEGACY_FULL&&E.components.properties.update(c,{displayMode:l.SCALE_TO_FILL},!0),E.history.add("Change Image"),k()}}})},changeVectorImage:function(n,e,a,o){var t=E.store.getState(),r=E.components.data.get(n),i=C.get(r,["svgId"]),s=E.media.vectorImage.getSvgInfoFromCache(i).svgType,d="shape"===s?g:h,c="shape"===s?f:"change_vector_art",l=m(i)(t)||a||d;E.mediaServices.mediaManager.open(E.mediaServices.mediaManager.categories[e||u],c,{multiSelect:!1,callback:function(e,a){if(!C.isEmpty(e)){var t=C.get(e,[0,"title"],""),i=C.get(e,[0,"uri"]);A.vectorImageUtils.replaceVectorImage(E,n,r,t,i,o),E.store.dispatch(R("last_media_path_"+i,a.path||"")),k()}},path:l})},changeClipArt:function(i,e){var a=E.components.data.get(i),t=E.store.getState(),n=m(a.uri)(t);E.mediaServices.mediaManager.open(e,{multiSelect:!1,translation:{submitButton:A.translate("MMGR_submitbutton_onstage_clipart_freeclipart_choose")},path:n,callback:function(e,a){if(e){var t=C.pick(e[0],d);t.uri=e[0].fileName,t.originalImageDataRef=null,t.crop=null,E.store.dispatch(R("last_media_path_"+t.uri,a.path)),E.components.data.update(i,t,!0),E.history.add("Change Clipart"),k()}}})},changeVideo:function(S){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:E.mediaServices.mediaManager.categories.VIDEO,a=E.store,y=a.dispatch,t=a.getState,M=E.components.design.get(S),b=E.components.properties.get(S),T=E.components.layout.get(S),i=C.get(M.background,["mediaRef","videoId"],""),n=C.get(M.background,["mediaRef","mediaFeatures"],[]),o=s("last_media_path_"+i)(t());!o&&C.includes(n,"alpha")&&(o="public/5d54b10e-e5e3-416b-9a2f-9316773f2a5b/078ecd58-f828-44f6-ac91-8cafbf5dbdae"),E.mediaServices.mediaManager.open(e,"change_video_box",{multiSelect:!1,callback:function(e,a){if(e){var t=C.head(e),i=P(t,a);if(C.includes(i.mediaFeatures,"alpha")){var n=C.maxBy(i.qualities,"width")||{},o=n.width/n.height,r=E.dsRead.components.layout.getLimits(C.isArray(S)?S[0]:S),s=C.assign({},r,T),d=A.layoutUtils.getLayoutWithAspectRatio(s,o,null);E.components.layout.update(S,d,!0)}var c,l,u,g,p=(c=M,l=i.mediaFeatures,u=C.includes(l,"alpha"),g=C.cloneDeep(c),u?(g.cssStyle={cssBorder:null,cssBorderRadius:null,cssBoxShadow:null},g.background.imageOverlay=null,g.background.colorOverlay=""):g.background.filterEffect=null,g);p.background.mediaRef=i,E.components.design.update(S,p,!0);var m={};C.get(b,"autoplay")&&C.assign(m,{autoplay:!0,mute:!0}),E.components.properties.update(S,m);var h=E.components.getChildren(S),f=C.find(h,function(e){return"wysiwyg.viewer.components.MediaControls"===E.components.getType(e)}),_=E.components.properties.get(f),v=C.get(_,"showStoryboard");_.showStoryboard=L(i,v),E.components.properties.update(f,_,!0),E.history.add("Change Video"),E.store.dispatch(F.editorPlugins.bi.actions.event(I.video_player_video_changed,w(e[0],"video_player_gfpp"))),y(R("last_media_path_"+i.videoId,a.path||"")),k()}},path:o})},changeShape:function(i){var e=E.mediaServices;e.mediaManager.open(e.mediaManager.categories.SHAPE,f,{multiSelect:!1,callback:function(e){if(!C.isEmpty(e)){var a=A.svgUrlParser.parseSvgSkinFromUrl(e[0].fileUrl),t=E.components.style.get(i);a!==t.skin&&(t.skin=a,E.components.style.update(i,t),E.history.add("Change Shape"),k())}},translation:{submitButton:A.translate("Shape_Media_Change_Shape")}})}}}}});
//# sourceMappingURL=mediaServices.min.js.map